# æ—…éŠå‰µä½œè€…åª’é«”å¹³å° - UIå„ªåŒ–ä½¿ç”¨èªªæ˜

## ğŸ¯ å„ªåŒ–æ¦‚è¿°

æœ¬æ¬¡å„ªåŒ–ä¸»è¦é‡å°ä»»å‹™éšæ®µç®¡ç†ã€ç”¨æˆ¶é«”é©—å’Œè§’è‰²åˆ†æµå°èˆªé€²è¡Œäº†å…¨é¢æ”¹é€²ï¼Œè®“ç”¨æˆ¶èƒ½å¤ æ›´ç›´è§€åœ°äº†è§£ä»»å‹™é€²åº¦ï¼Œå¿«é€ŸåŸ·è¡Œç›¸é—œæ“ä½œã€‚

## ğŸš€ æ–°å¢åŠŸèƒ½

### 1. ä»»å‹™éšæ®µé€²åº¦åˆ—ç³»çµ±

#### åŠŸèƒ½ç‰¹é»
- **è¦–è¦ºåŒ–é€²åº¦**: 8å€‹éšæ®µçš„æ¸…æ™°é€²åº¦æŒ‡ç¤ºå™¨
- **äº’å‹•å¼è¨­è¨ˆ**: å¯é»æ“Šçš„éšæ®µåœ–æ¨™ï¼Œæ”¯æŒéšæ®µåˆ‡æ›
- **é€²åº¦ç™¾åˆ†æ¯”**: å¯¦æ™‚é¡¯ç¤ºä»»å‹™å®Œæˆé€²åº¦
- **ç‹€æ…‹é¡è‰²**: æ¯å€‹éšæ®µéƒ½æœ‰ç¨ç‰¹çš„é¡è‰²å’Œåœ–æ¨™

#### éšæ®µå®šç¾©
| éšæ®µ | åç¨± | åœ–æ¨™ | é¡è‰² | æè¿° |
|------|------|------|------|------|
| draft | è‰ç¨¿ | ğŸ“ | #6B7280 | ä»»å‹™å‰µå»ºéšæ®µ |
| published | å·²ç™¼å¸ƒ | ğŸš€ | #3B82F6 | ä»»å‹™å…¬é–‹éšæ®µ |
| collecting | å¾µé›†ä¸­ | ğŸ” | #F59E0B | æ”¶é›†å‰µä½œè€…ææ¡ˆ |
| evaluating | è©•ä¼°ä¸­ | ğŸ“Š | #8B5CF6 | è©•ä¼°ææ¡ˆéšæ®µ |
| in_progress | å‰µä½œä¸­ | ğŸ¨ | #10B981 | å…§å®¹å‰µä½œéšæ®µ |
| reviewing | å¯©æ ¸ä¸­ | ğŸ“‹ | #EF4444 | å…§å®¹å¯©æ ¸éšæ®µ |
| publishing | ç™¼å¸ƒä¸­ | ğŸ“¡ | #06B6D4 | å…§å®¹ç™¼å¸ƒéšæ®µ |
| completed | å·²å®Œæˆ | ğŸ | #059669 | ä»»å‹™å®Œæˆéšæ®µ |

### 2. æ™ºèƒ½ä»»å‹™å¡ç‰‡

#### å¡ç‰‡åŠŸèƒ½
- **ç‹€æ…‹é¡¯ç¤º**: æ¸…æ™°çš„ä»»å‹™ç‹€æ…‹æ¨™ç±¤å’Œåœ–æ¨™
- **é€²åº¦è¿½è¹¤**: å…§åµŒé€²åº¦æ¢é¡¯ç¤ºå®Œæˆç™¾åˆ†æ¯”
- **æ“ä½œæŒ‰éˆ•**: æ ¹æ“šç”¨æˆ¶è§’è‰²å’Œä»»å‹™éšæ®µå‹•æ…‹é¡¯ç¤º
- **å¯æ”¶åˆå€åŸŸ**: é€²åº¦èªªæ˜ã€æºé€šè¨˜éŒ„ã€é‡Œç¨‹ç¢‘ä¿¡æ¯

#### è§’è‰²ç‰¹å®šæ“ä½œ
- **ä¾›æ‡‰å•†**: æŸ¥çœ‹ææ¡ˆã€è©•ä¼°ææ¡ˆã€å¯©æ ¸å…§å®¹
- **å‰µä½œè€…**: ç«‹å³ææ¡ˆã€ä¸Šå‚³å…§å®¹ã€æŸ¥çœ‹ç‹€æ…‹
- **åª’é«”**: ä¸‹è¼‰ç´ æã€ç™¼å¸ƒå…§å®¹ã€è¿½è¹¤æ•ˆæœ

### 3. è§’è‰²åˆ†æµå°èˆª

#### é¦–é è¨­è¨ˆ
- **ä¸‰å¤§è§’è‰²é¸æ“‡**: ä¾›æ‡‰å•†ã€å‰µä½œè€…ã€åª’é«”
- **åŠŸèƒ½ä»‹ç´¹**: æ¯å€‹è§’è‰²çš„ä¸»è¦åŠŸèƒ½å’Œå„ªå‹¢
- **çµ±è¨ˆæ•¸æ“š**: å¹³å°æ´»èºç”¨æˆ¶å’Œå®Œæˆä»»å‹™æ•¸é‡
- **å¿«é€Ÿå°èˆª**: ä¸€éµé€²å…¥å°æ‡‰è§’è‰²å„€è¡¨æ¿

### 4. è§’è‰²å°ˆå±¬å„€è¡¨æ¿

#### ä¾›æ‡‰å•†å„€è¡¨æ¿
- **çµ±è¨ˆæ¦‚è¦½**: ç¸½ä»»å‹™æ•¸ã€é€²è¡Œä¸­ä»»å‹™ã€ç¸½é ç®—ã€æ»¿æ„åº¦
- **å¿«é€Ÿæ“ä½œ**: ç™¼å¸ƒæ–°ä»»å‹™ã€æŸ¥çœ‹ææ¡ˆã€å¯©æ ¸å…§å®¹ã€æ•ˆæœè¿½è¹¤
- **éšæ®µçµ±è¨ˆ**: å„éšæ®µä»»å‹™æ•¸é‡åˆ†å¸ƒ
- **ä»»å‹™åˆ—è¡¨**: æŒ‰éšæ®µç¯©é¸çš„ä»»å‹™å¡ç‰‡
- **é€²åº¦è¿½è¹¤**: æ•´é«”å®Œæˆç‡å’Œé—œéµæŒ‡æ¨™

#### å‰µä½œè€…å„€è¡¨æ¿ (å¾…å¯¦ç¾)
- **ç”³è«‹çµ±è¨ˆ**: ç¸½ç”³è«‹æ•¸ã€é€²è¡Œä¸­ä»»å‹™ã€å®Œæˆä»»å‹™
- **æ¨è–¦ä»»å‹™**: åŸºæ–¼å°ˆé•·çš„ä»»å‹™æ¨è–¦
- **ä½œå“ç®¡ç†**: ä¸Šå‚³å…§å®¹ã€æŸ¥çœ‹åé¥‹

#### åª’é«”å„€è¡¨æ¿ (å¾…å¯¦ç¾)
- **ç™¼å¸ƒçµ±è¨ˆ**: ç¸½ç™¼å¸ƒæ•¸ã€é€²è¡Œä¸­ç™¼å¸ƒã€å®Œæˆç™¼å¸ƒ
- **ç´ æä¸‹è¼‰**: å¯ä¸‹è¼‰çš„å…§å®¹ç´ æ
- **æ•ˆæœè¿½è¹¤**: ç™¼å¸ƒæ•ˆæœæ•¸æ“šåˆ†æ

## ğŸ› ï¸ æŠ€è¡“å¯¦ç¾

### å¾Œç«¯æœå‹™

#### TaskStageService
```php
// ä¸»è¦åŠŸèƒ½
- ä»»å‹™éšæ®µè½‰æ›ç®¡ç†
- é€²åº¦è¨ˆç®—å’Œè¿½è¹¤
- éšæ®µæ­·å²è¨˜éŒ„
- è§’è‰²ç‰¹å®šå„€è¡¨æ¿æ•¸æ“š

// æ ¸å¿ƒæ–¹æ³•
- transitionTask(): è½‰æ›ä»»å‹™éšæ®µ
- getTaskProgress(): ç²å–ä»»å‹™é€²åº¦
- getTaskDashboard(): ç²å–å„€è¡¨æ¿æ•¸æ“š
- getTasksByStage(): æŒ‰éšæ®µç²å–ä»»å‹™
```

#### TaskStageController
```php
// APIç«¯é»
- GET /api/tasks/{id}/progress - ç²å–ä»»å‹™é€²åº¦
- POST /api/tasks/{id}/transition - è½‰æ›ä»»å‹™éšæ®µ
- GET /api/dashboard - ç²å–å„€è¡¨æ¿æ•¸æ“š
- GET /api/tasks/by-stage - æŒ‰éšæ®µç²å–ä»»å‹™
- GET /api/stages - ç²å–æ‰€æœ‰éšæ®µé…ç½®
```

#### NotificationService
```php
// è‡ªå‹•é€šçŸ¥
- éšæ®µè½‰æ›é€šçŸ¥
- æˆªæ­¢æ—¥æœŸæé†’
- ææ¡ˆè©•ä¼°æé†’
- å…§å®¹å¯©æ ¸æé†’
```

### å‰ç«¯çµ„ä»¶

#### TaskProgressBar
```tsx
// ä¸»è¦å±¬æ€§
interface TaskProgressBarProps {
  stages: TaskStage[];
  currentStage: string;
  progress: number;
  onStageClick?: (stageId: string) => void;
  showLabels?: boolean;
  compact?: boolean;
}

// ä½¿ç”¨ç¤ºä¾‹
<TaskProgressBar
  stages={taskStages}
  currentStage="collecting"
  progress={25}
  onStageClick={handleStageClick}
  showLabels={true}
/>
```

#### TaskCard
```tsx
// ä¸»è¦å±¬æ€§
interface TaskCardProps {
  task: Task;
  userRole: "supplier" | "creator" | "media";
  onAction?: (action: string, taskId: string) => void;
  showProgress?: boolean;
  compact?: boolean;
}

// ä½¿ç”¨ç¤ºä¾‹
<TaskCard
  task={taskData}
  userRole="supplier"
  onAction={handleTaskAction}
  showProgress={true}
/>
```

## ğŸ“± ä½¿ç”¨æ–¹æ³•

### 1. è¨ªå•è§’è‰²é¸æ“‡é é¢
```
URL: /role-selection
åŠŸèƒ½: é¸æ“‡ç”¨æˆ¶è§’è‰²ï¼Œé€²å…¥å°æ‡‰å„€è¡¨æ¿
```

### 2. ä¾›æ‡‰å•†ä½¿ç”¨æµç¨‹
```
1. é¸æ“‡ã€Œæ—…éŠæœå‹™ä¾›æ‡‰å•†ã€è§’è‰²
2. é€²å…¥ä¾›æ‡‰å•†å„€è¡¨æ¿
3. æŸ¥çœ‹ä»»å‹™çµ±è¨ˆå’Œé€²åº¦
4. ä½¿ç”¨å¿«é€Ÿæ“ä½œæŒ‰éˆ•
5. æŒ‰éšæ®µç¯©é¸å’Œç®¡ç†ä»»å‹™
```

### 3. å‰µä½œè€…ä½¿ç”¨æµç¨‹
```
1. é¸æ“‡ã€Œå…§å®¹å‰µä½œè€…ã€è§’è‰²
2. ç€è¦½æ¨è–¦ä»»å‹™
3. æäº¤å‰µæ„ææ¡ˆ
4. å‰µä½œå’Œä¸Šå‚³å…§å®¹
5. è¿½è¹¤ä»»å‹™é€²åº¦
```

### 4. åª’é«”ä½¿ç”¨æµç¨‹
```
1. é¸æ“‡ã€Œåª’é«”é€šè·¯ã€è§’è‰²
2. æŸ¥çœ‹å¯ç™¼å¸ƒå…§å®¹
3. ä¸‹è¼‰é«˜å“è³ªç´ æ
4. å¤šå¹³å°ç™¼å¸ƒå…§å®¹
5. è¿½è¹¤ç™¼å¸ƒæ•ˆæœ
```

## ğŸ”§ é…ç½®èªªæ˜

### éšæ®µé…ç½®è‡ªå®šç¾©
```php
// åœ¨ TaskStageService ä¸­ä¿®æ”¹ STAGES å¸¸é‡
const STAGES = [
    'custom_stage' => [
        'name' => 'è‡ªå®šç¾©éšæ®µ',
        'color' => '#FF0000',
        'icon' => 'ğŸ¯',
        'order' => 10,
        'can_edit' => ['supplier'],
        'next_stages' => ['next_stage']
    ]
];
```

### é€šçŸ¥é…ç½®
```php
// åœ¨ NotificationService ä¸­é…ç½®é€šçŸ¥è§¸ç™¼æ¢ä»¶
public function sendStageTransitionNotifications(array $task, string $oldStage, string $newStage): void
{
    // è‡ªå®šç¾©é€šçŸ¥é‚è¼¯
    switch ($newStage) {
        case 'custom_stage':
            $this->sendCustomNotification($task);
            break;
    }
}
```

### å‰ç«¯æ¨£å¼è‡ªå®šç¾©
```css
/* è‡ªå®šç¾©éšæ®µé¡è‰² */
.task-stage-custom {
    background-color: var(--custom-color);
    color: white;
}

/* è‡ªå®šç¾©é€²åº¦æ¢æ¨£å¼ */
.task-progress-custom {
    background: linear-gradient(to right, var(--start-color), var(--end-color));
}
```

## ğŸ“Š æ•¸æ“šåº«çµæ§‹

### æ–°å¢è¡¨
- `task_stage_history`: ä»»å‹™éšæ®µè®Šæ›´æ­·å²
- `task_activities`: ä»»å‹™æ´»å‹•è¨˜éŒ„
- `task_stages`: ä»»å‹™éšæ®µé€²åº¦
- `task_communications`: ä»»å‹™æºé€šè¨˜éŒ„
- `task_milestones`: ä»»å‹™é‡Œç¨‹ç¢‘
- `task_files`: ä»»å‹™æ–‡ä»¶ç®¡ç†
- `task_ratings`: ä»»å‹™è©•åƒ¹ç³»çµ±
- `task_notification_settings`: é€šçŸ¥è¨­ç½®

### è¦–åœ–å’Œå‡½æ•¸
- `task_progress_summary`: ä»»å‹™é€²åº¦æ‘˜è¦è¦–åœ–
- `user_task_stats`: ç”¨æˆ¶ä»»å‹™çµ±è¨ˆè¦–åœ–
- `get_task_stage_stats()`: éšæ®µçµ±è¨ˆå‡½æ•¸
- `check_task_deadline()`: æˆªæ­¢æ—¥æœŸæª¢æŸ¥å‡½æ•¸

## ğŸš¨ æ³¨æ„äº‹é …

### 1. æ¬Šé™æ§åˆ¶
- éšæ®µè½‰æ›éœ€è¦ç›¸æ‡‰æ¬Šé™
- ä¸åŒè§’è‰²åªèƒ½åŸ·è¡Œå°æ‡‰æ“ä½œ
- æ•æ„Ÿæ“ä½œéœ€è¦äºŒæ¬¡ç¢ºèª

### 2. æ•¸æ“šä¸€è‡´æ€§
- éšæ®µè½‰æ›ä½¿ç”¨äº‹å‹™è™•ç†
- é€²åº¦è¨ˆç®—è‡ªå‹•æ›´æ–°
- æ­·å²è¨˜éŒ„å®Œæ•´ä¿å­˜

### 3. æ€§èƒ½å„ªåŒ–
- å¤§é‡æ•¸æ“šä½¿ç”¨åˆ†é 
- ç·©å­˜å¸¸ç”¨é…ç½®æ•¸æ“š
- ç•°æ­¥è™•ç†é€šçŸ¥ç™¼é€

## ğŸ”® æœªä¾†æ“´å±•

### 1. æ™ºèƒ½æ¨è–¦
- åŸºæ–¼ç”¨æˆ¶è¡Œç‚ºçš„ä»»å‹™æ¨è–¦
- å‰µä½œè€…èƒ½åŠ›åŒ¹é…ç®—æ³•
- ä¾›æ‡‰å•†éœ€æ±‚é æ¸¬

### 2. è‡ªå‹•åŒ–æµç¨‹
- æ™ºèƒ½éšæ®µè½‰æ›
- è‡ªå‹•æˆªæ­¢æ—¥æœŸæé†’
- æ‰¹é‡ä»»å‹™è™•ç†

### 3. æ•¸æ“šåˆ†æ
- ä»»å‹™å®Œæˆç‡åˆ†æ
- ç”¨æˆ¶è¡Œç‚ºåˆ†æ
- å¹³å°æ•ˆç‡å„ªåŒ–

## ğŸ“ æŠ€è¡“æ”¯æŒ

å¦‚æœ‰æŠ€è¡“å•é¡Œæˆ–éœ€è¦é€²ä¸€æ­¥å„ªåŒ–ï¼Œè«‹è¯ç¹«é–‹ç™¼åœ˜éšŠæˆ–æŸ¥çœ‹ç›¸é—œæ–‡æª”ã€‚

---

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2024å¹´1æœˆ  
**ç¶­è­·åœ˜éšŠ**: æ—…éŠå‰µä½œè€…åª’é«”å¹³å°é–‹ç™¼çµ„
