# 🚀 旅遊平台 Supervisor 進程管理配置
# 用於管理PHP-FPM、Redis、備份等服務

[program:travel-platform-php-fpm]
command=/usr/sbin/php-fpm8.1 --nodaemonize --fpm-config /etc/php/8.1/fpm/php-fpm.conf
autostart=true
autorestart=true
startretries=3
user=www-data
group=www-data
stdout_logfile=/var/log/supervisor/php-fpm.log
stderr_logfile=/var/log/supervisor/php-fpm-error.log
priority=100

[program:travel-platform-redis]
command=/usr/bin/redis-server /etc/redis/redis.conf
autostart=true
autorestart=true
startretries=3
user=redis
group=redis
stdout_logfile=/var/log/supervisor/redis.log
stderr_logfile=/var/log/supervisor/redis-error.log
priority=200

[program:travel-platform-backup]
command=/usr/bin/php /var/www/travel-platform/backend/scripts/backup.php
autostart=false
autorestart=false
user=www-data
group=www-data
stdout_logfile=/var/log/supervisor/backup.log
stderr_logfile=/var/log/supervisor/backup-error.log
priority=300

[program:travel-platform-queue-worker]
command=/usr/bin/php /var/www/travel-platform/backend/scripts/queue-worker.php
autostart=true
autorestart=true
startretries=3
user=www-data
group=www-data
stdout_logfile=/var/log/supervisor/queue-worker.log
stderr_logfile=/var/log/supervisor/queue-worker-error.log
priority=400
numprocs=2
process_name=%(program_name)s_%(process_num)02d

[program:travel-platform-monitor]
command=/usr/bin/php /var/www/travel-platform/backend/scripts/monitor.php
autostart=true
autorestart=true
startretries=3
user=www-data
group=www-data
stdout_logfile=/var/log/supervisor/monitor.log
stderr_logfile=/var/log/supervisor/monitor-error.log
priority=500

[group:travel-platform]
programs=travel-platform-php-fpm,travel-platform-redis,travel-platform-queue-worker,travel-platform-monitor
priority=999
