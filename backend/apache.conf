# ğŸš€ æ—…éŠå¹³å° Apache ç”Ÿç”¢ç’°å¢ƒé…ç½®
# è«‹æ ¹æ“šå¯¦éš›ç’°å¢ƒä¿®æ”¹ä»¥ä¸‹é…ç½®

<VirtualHost *:80>
    ServerName your-domain.com
    ServerAlias www.your-domain.com
    DocumentRoot /var/www/travel-platform/backend/public
    
    # é‡å®šå‘åˆ°HTTPS
    Redirect permanent / https://your-domain.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName your-domain.com
    ServerAlias www.your-domain.com
    DocumentRoot /var/www/travel-platform/backend/public
    
    # SSLé…ç½®
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/your-domain.com/cert.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/your-domain.com/privkey.pem
    SSLCertificateChainFile /etc/letsencrypt/live/your-domain.com/chain.pem
    
    # SSLå®‰å…¨è¨­ç½®
    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384
    SSLHonorCipherOrder on
    SSLCompression off
    
    # å®‰å…¨æ¨™é ­
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # æ—¥èªŒé…ç½®
    ErrorLog ${APACHE_LOG_DIR}/travel-platform-error.log
    CustomLog ${APACHE_LOG_DIR}/travel-platform-access.log combined
    
    # ç›®éŒ„é…ç½®
    <Directory /var/www/travel-platform/backend/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # å¿«å–è¨­ç½®
        <IfModule mod_expires.c>
            ExpiresActive on
            ExpiresByType text/css "access plus 1 year"
            ExpiresByType application/javascript "access plus 1 year"
            ExpiresByType image/png "access plus 1 year"
            ExpiresByType image/jpg "access plus 1 year"
            ExpiresByType image/jpeg "access plus 1 year"
            ExpiresByType image/gif "access plus 1 year"
            ExpiresByType image/ico "access plus 1 year"
            ExpiresByType image/svg+xml "access plus 1 year"
            ExpiresByType application/pdf "access plus 1 year"
        </IfModule>
        
        # Gzipå£“ç¸®
        <IfModule mod_deflate.c>
            AddOutputFilterByType DEFLATE text/plain
            AddOutputFilterByType DEFLATE text/html
            AddOutputFilterByType DEFLATE text/xml
            AddOutputFilterByType DEFLATE text/css
            AddOutputFilterByType DEFLATE application/xml
            AddOutputFilterByType DEFLATE application/xhtml+xml
            AddOutputFilterByType DEFLATE application/rss+xml
            AddOutputFilterByType DEFLATE application/javascript
            AddOutputFilterByType DEFLATE application/x-javascript
        </IfModule>
    </Directory>
    
    # ä¸Šå‚³ç›®éŒ„é…ç½®
    <Directory /var/www/travel-platform/backend/uploads>
        Options -Indexes
        AllowOverride None
        Require all granted
        
        # å¿«å–è¨­ç½®
        <IfModule mod_expires.c>
            ExpiresActive on
            ExpiresByType image/* "access plus 1 year"
            ExpiresByType video/* "access plus 1 year"
            ExpiresByType application/pdf "access plus 1 year"
        </IfModule>
    </Directory>
    
    # å¥åº·æª¢æŸ¥
    <Location /health>
        SetHandler application/x-httpd-php
        Require all granted
    </Location>
    
    # ç¦æ­¢è¨ªå•æ•æ„Ÿæ–‡ä»¶
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    <FilesMatch "\.(htaccess|htpasswd|ini|log|sh|sql|conf)$">
        Require all denied
    </FilesMatch>
    
    # å®¢æˆ¶ç«¯é…ç½®
    LimitRequestBody 52428800
    Timeout 300
</VirtualHost>

# å‰ç«¯æ‡‰ç”¨é…ç½®ï¼ˆå¦‚æœä½¿ç”¨å­åŸŸåï¼‰
<VirtualHost *:80>
    ServerName app.your-domain.com
    DocumentRoot /var/www/travel-platform/dist
    
    # é‡å®šå‘åˆ°HTTPS
    Redirect permanent / https://app.your-domain.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName app.your-domain.com
    DocumentRoot /var/www/travel-platform/dist
    
    # SSLé…ç½®
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/app.your-domain.com/cert.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/app.your-domain.com/privkey.pem
    SSLCertificateChainFile /etc/letsencrypt/live/app.your-domain.com/chain.pem
    
    # SSLå®‰å…¨è¨­ç½®
    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384
    SSLHonorCipherOrder on
    SSLCompression off
    
    # å®‰å…¨æ¨™é ­
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # æ—¥èªŒé…ç½®
    ErrorLog ${APACHE_LOG_DIR}/travel-platform-frontend-error.log
    CustomLog ${APACHE_LOG_DIR}/travel-platform-frontend-access.log combined
    
    # ç›®éŒ„é…ç½®
    <Directory /var/www/travel-platform/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # å¿«å–è¨­ç½®
        <IfModule mod_expires.c>
            ExpiresActive on
            ExpiresByType text/css "access plus 1 year"
            ExpiresByType application/javascript "access plus 1 year"
            ExpiresByType image/png "access plus 1 year"
            ExpiresByType image/jpg "access plus 1 year"
            ExpiresByType image/jpeg "access plus 1 year"
            ExpiresByType image/gif "access plus 1 year"
            ExpiresByType image/ico "access plus 1 year"
            ExpiresByType image/svg+xml "access plus 1 year"
            ExpiresByType font/woff "access plus 1 year"
            ExpiresByType font/woff2 "access plus 1 year"
            ExpiresByType application/font-woff "access plus 1 year"
            ExpiresByType application/font-woff2 "access plus 1 year"
        </IfModule>
        
        # Gzipå£“ç¸®
        <IfModule mod_deflate.c>
            AddOutputFilterByType DEFLATE text/plain
            AddOutputFilterByType DEFLATE text/html
            AddOutputFilterByType DEFLATE text/xml
            AddOutputFilterByType DEFLATE text/css
            AddOutputFilterByType DEFLATE application/xml
            AddOutputFilterByType DEFLATE application/xhtml+xml
            AddOutputFilterByType DEFLATE application/rss+xml
            AddOutputFilterByType DEFLATE application/javascript
            AddOutputFilterByType DEFLATE application/x-javascript
        </IfModule>
        
        # å‰ç«¯è·¯ç”±æ”¯æŒ
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # ç¦æ­¢è¨ªå•æ•æ„Ÿæ–‡ä»¶
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    <FilesMatch "\.(htaccess|htpasswd|ini|log|sh|sql|conf)$">
        Require all denied
    </FilesMatch>
</VirtualHost>
